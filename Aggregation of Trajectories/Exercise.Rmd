# AGGREGATION OF TRAJECTORIES

-------------

## Homework

* Use trajectory aggregation to describe how Holger's cycling differs from mine
* Comparisons can be qualitative (visual) or quantitative (numeric)

```{r}
require(trajectories)
require(spacetime)
require(maptools)
#Sys.setenv(JAVA_HOME='C:\\Program Files\\Java\\jre7')
require(OpenStreetMap)
require(ggplot2)
require (rgdal)
require (maptools)
require(plotKML)

## Holger's Cycle Tracks

getTr <- function (file) {
  tr <- readGPX (file)
  tr <- tr$tracks[[1]][[1]]
  crs <- CRS ("+proj=longlat")
  sp <- SpatialPoints (tr[,1:2], crs)
  t <- as.POSIXct(strptime(tr$time, "%Y-%m-%dT%H:%M:%SZ"))
  stidf <- STIDF (sp, t, data.frame (tr$ele))
  as (stidf, "Track")
}

ddir <- "dat/gpx-tracks/"
files <- list.files (ddir)
files <- as.character (sapply (files, function (x) paste (ddir, x, sep="")))
runs <- rides1 <- list ()
for (f in files) {
  cat (f, "\n")
  tr <- getTr (f)
  if (length (grep ("Running", f)) > 0) 
  {
  runs <- c (runs, tr)
  }
  else
  {
  rides1 <- c (rides1, tr)
  }
}

holger <- TracksCollection(list(rides1=Tracks(rides1)))
plot(holger, col="red")

## Mark's Cycle Tracks

getTr <- function (file) {
    tr <- readGPX (file)
    tr <- tr$tracks[[1]][[1]]
    crs <- CRS ("+proj=longlat")
    sp <- SpatialPoints (tr[,1:2], crs)
    t <- as.POSIXct(strptime(tr$time, "%Y-%m-%dT%H:%M:%OSZ"))
    stidf <- STIDF (sp, t, data.frame (tr$ele))
    as (stidf, "Track")
  }


ddir <- "dat/gpx-tracks-mp/"
files <- list.files (ddir)
files <- as.character (sapply (files, function (x) paste (ddir, x, sep="")))
rides2 <- list ()
for (f in files) {
  cat (f, "\n")
  rides2 <- c (rides2, getTr (f))
}
mark <- TracksCollection (list (rides2=Tracks (rides2)))
plot (mark, col="blue", lwd=1)

tracklength <- function(x) {
  
  l <- length(x) - 1
  distance <- 0
  
  for(i in 1:l) { 
    x1 <-x[i,]
    x2 <- x[i+1,]
    gap <- (spDists(x1, x2, longlat = TRUE)) * 1000
    distance <- distance + gap
  }
  
  as.numeric(distance)
}


```

-------------


<span style="color:green"; font-size:2em>
Holger:
Tracks are from Münster, Möhnesee and Zürich
TracksCollection contains both cycling and running <br>
</span>

<span style="color:blue"; font-size:2em>
<br>Mark:
Tracks are only from Münster
TracksCollection contains only cycling: Therefore, we only compare these with Holger's cycling tracks
</span>

<span style="color:green"; font-size:2em>
<br> Holger 1: 14.05.2014 16:20 - 17:04 Münster ~ 65 metres in height
</span>

```{r}
tracklength(holger@tracksCollection$rides1@tracks$Track1@sp)
```

<span style="color:green"; font-size:2em>
<br> Holger 2: 08.06.2014 06:02 - 11:07 Möhnesee ~ 80 - 211 metres in height
</span>

```{r}
tracklength(holger@tracksCollection$rides1@tracks$Track2@sp)
```

<span style="color:green"; font-size:2em>
<br> Holger 3: 12.07.2014 09:05 - 11:28 Airport Münster/Osnabrück  ~ 50 - 70 metres in height
</span>

```{r}
tracklength(holger@tracksCollection$rides1@tracks$Track3@sp)
```

<span style="color:green"; font-size:2em>
<br> Holger 4: 06.08.2014 06:28 - 08:34 Münster ~ 65 metres in height
</span>

```{r}
tracklength(holger@tracksCollection$rides1@tracks$Track4@sp)
```

<span style="color:green"; font-size:2em>
<br> Holger 5: 16.08.2014 09:43 - 11:54 Münster ~ 65 metres in height
</span>

```{r}
tracklength(holger@tracksCollection$rides1@tracks$Track5@sp)
```

<span style="color:green"; font-size:2em>
<br> Holger 6: 29.08.2014 10:15 - 12:56 Zürich  ~ 405 - 440 metres in height
</span>

```{r}
tracklength(holger@tracksCollection$rides1@tracks$Track6@sp)
```

<span style="color:green"; font-size:2em>
<br> Holger 7: 20.09.2014 07:36 - 11:27 Rheine/Emsdetten ~ 50 metres in height
</span>

```{r}
tracklength(holger@tracksCollection$rides1@tracks$Track7@sp)
```

<span style="color:blue"; font-size:2em>
<br> <br> Mark 1: 28.09.2014 14:04 - 15:47 Münster/Havixbeck ~ 60 metres in height
</span>

```{r}
tracklength(mark@tracksCollection$rides2@tracks$Track1@sp)
```

<span style="color:blue"; font-size:2em>
Mark 2: 02.10.2014 15:12 - 16:55 Münster/Havixbeck ~ 60 metres in height
</span>

```{r}
tracklength(mark@tracksCollection$rides2@tracks$Track2@sp)
```


<span style="color:blue"; font-size:2em>
Mark 3: 04.10.2014 13:25 - 17:01 Coesfeld/Münster  ~ 65 - 84 metres in height
</span>

```{r}
tracklength(mark@tracksCollection$rides2@tracks$Track3@sp)
```
-----